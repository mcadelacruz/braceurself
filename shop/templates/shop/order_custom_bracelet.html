{% extends 'shop/base.html' %}
{% block content %}
<h2>Order Custom Bracelet</h2>
<div class="mb-3">
    <strong>Design Name:</strong> {{ design.name }}<br>
    <label for="beadDropdown" class="form-label"><strong>Design Details:</strong></label>
    <select id="beadDropdown" class="form-select" size="8" style="max-width:320px;">
        {% for bead in design.text_form %}
            <option>{{ bead }}</option>
        {% endfor %}
    </select>
</div>
<div>
    <canvas id="bracelet-canvas" width="400" height="400" style="border:1px solid #ccc; background:#fff; border-radius:50%;"></canvas>
</div>
<form method="post" class="mt-4">
    {% csrf_token %}
    <label for="payment_type" class="form-label">Payment Type</label>
    <select name="payment_type" id="payment_type" class="form-select mb-3">
        <option value="gcash">GCash</option>
        <option value="maya">Maya</option>
    </select>
    <button type="submit" class="btn btn-success">Place Order</button>
    <a href="{% url 'customize_bracelet' %}" class="btn btn-link">Back to Designs</a>
</form>
<script>
const beads = {{ design.beads|safe }};
const canvas = document.getElementById('bracelet-canvas');
const ctx = canvas.getContext('2d');
function drawBracelet() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    const cx = canvas.width/2, cy = canvas.height/2, r = 150;
    const n = beads.length;
    for (let i=0; i<n; ++i) {
        const angle = (2*Math.PI*i)/n;
        const bx = cx + r*Math.cos(angle);
        const by = cy + r*Math.sin(angle);
        const bead = beads[i];
        ctx.save();
        ctx.translate(bx, by);
        ctx.rotate(angle + Math.PI/2);
        ctx.beginPath();
        ctx.fillStyle = bead.color || "#888";
        let size = bead.size === "large" ? 28 : bead.size === "medium" ? 20 : 14;
        if (bead.shape === "circle") {
            ctx.arc(0, 0, size, 0, 2*Math.PI);
            ctx.fill();
        } else if (bead.shape === "square") {
            ctx.rect(-size, -size, size*2, size*2);
            ctx.fill();
        } else if (bead.shape === "triangle") {
            ctx.moveTo(0, -size);
            ctx.lineTo(size, size);
            ctx.lineTo(-size, size);
            ctx.closePath();
            ctx.fill();
        }
        ctx.restore();
    }
}
drawBracelet();
</script>
{% endblock %}
